<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lineup Card Factory — Law 5 Referee</title>

  <link rel="icon" href="images/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="css/fast-card-factory.css">
</head>

<body class="admin-page">

<header>
  <h1>Law Five Referee — Lineup Card Factory</h1>
  <nav>
    <a href="/index.html">Home</a>
    <a href="/apps/game-card-factory/index.html">Game Card Factory</a>
    <a href="/apps/lineup-card-factory/index.html">Lineup Card Factory</a>
  </nav>
</header>

<div class="container">

  <h1>Lineup Card Factory</h1>

  <!-- ============================================================
       1. TEAM INFO & ROSTER
  ============================================================ -->
  <section class="collapsible-panel" id="section-1-team">
    <button class="collapsible-header">
      <span class="collapsible-icon">+</span>
      <span class="collapsible-title">1. Paste / Edit Team Info & Roster</span>
    </button>
    <p class="section-subtitle" id="status-section-1-team">Load or create a team.</p>
    <div class="collapsible-body">

      <!-- Team selector -->
      <div class="team-selector-row">
        <label for="teamSelect">Select Team:</label>
        <select id="teamSelect"></select>
        <button id="newTeamBtn" class="btn">New Team</button>
        <button id="cloneTeamBtn" class="secondary">Clone Team</button>
        <button id="deleteTeamBtn" class="secondary">Delete Team</button>
      </div>

      <!-- Team fields -->
      <div class="team-fields-grid">
        <input id="teamId" placeholder="Team ID (match schedule text)" class="macos-input">
        <input id="teamNumber" placeholder="Team Number" class="macos-input">
        <input id="teamName" placeholder="Team Name" class="macos-input">
        <input id="teamCoach" placeholder="Team Coach" class="macos-input">
        <input id="teamRegion" placeholder="Team Region" class="macos-input">
        <input id="teamAsstCoach" placeholder="Assistant Coach" class="macos-input">
        <input id="teamAgeDiv" placeholder="Age/Division" class="macos-input">
        <input id="teamColors" placeholder="Team Colors" class="macos-input">
      </div>

      <!-- Roster input -->
      <textarea id="rosterInput" class="import-textarea"
        placeholder="Paste player roster: Number <tab> Player Name"></textarea>

      <div class="roster-buttons">
        <button id="parseRosterBtn" class="btn">Parse Roster</button>
        <button id="clearRosterBtn" class="secondary">Clear Roster</button>
        <button id="saveTeamBtn" class="btn">Save Team</button>
      </div>

      <div id="rosterTableContainer"></div>
    </div>
  </section>


<!-- ============================================================
     2. Schedule Import / Carousel
============================================================ -->
<!-- ============================================================
     IMPORT SCHEDULE CAROUSEL
============================================================ -->
<section class="collapsible-panel" id="section‑import">
  <button class="collapsible-header">
    <span class="collapsible-icon">+</span>
    <span class="collapsible-title">Import Schedule / Select Parser</span>
  </button>

  <div class="collapsible-body">

    <div class="shared‑carousel">
      <button id="carouselPrev" class="carousel‑nav">⟨</button>
      <div id="carouselViewport" class="carousel‑viewport"></div>
      <button id="carouselNext" class="carousel‑nav">⟩</button>
    </div>

    <div id="importStatus" class="status‑line">Choose a schedule or parser to begin.</div>
  <textarea id="rawInput" class="import-textarea"
  placeholder="Paste schedule text here"></textarea>

  </div>
</section>

<section class="collapsible-panel" id="section-2">
  <button class="collapsible-header">
    <span class="collapsible-icon">+</span>
    <span class="collapsible-title">2. Select / Import Schedule</span>
  </button>
  <p class="section-subtitle" id="status-section-2">Choose or import a schedule.</p>

  <div class="collapsible-body">

    <!-- carousel -->
    <div class="schedule-carousel">
      <button id="schedulePrev" class="carousel-nav">⟨</button>
      <div id="scheduleCarouselViewport" class="carousel-viewport"></div>
      <button id="scheduleNext" class="carousel-nav">⟩</button>
    </div>

    <!-- action row -->
    <div class="schedule-buttons">
      <button id="loadScheduleBtn" class="btn">Use Selected Schedule</button>
      <button id="saveScheduleBtn" class="btn secondary">Save Schedule</button>
<button id="deleteScheduleBtn" class="btn danger">Delete Selected Schedule</button>
    </div>

    <!-- optional raw paste -->
    <textarea id="rawInput" class="import-textarea"
      placeholder="Paste schedule text here (optional)"></textarea>

    <div class="schedule-feedback status-line" id="scheduleStatus">No schedule loaded.</div>

  </div>
</section>
<!-- Shared Parser Editor Modal -->
<div id="parserManagerModal" class="modal-backdrop hidden">
  <div class="modal-content">
    <h2 id="parserManagerTitle">Parser Editor</h2>

    <label>Parser Name</label>
    <input id="parserNameInput" type="text">

    <label>Description</label>
    <input id="parserDescInput" type="text">

    <label>Rules / Code</label>
    <textarea id="parserRulesInput" rows="8"
              placeholder="// Enter mapping rules or JS code"></textarea>

    <div class="modal-buttons">
      <button id="saveParserBtn" class="btn">Save Parser</button>
      <button id="cancelParserBtn" class="btn secondary">Cancel</button>
    </div>
  </div>
</div>


  <!-- ============================================================
       3. SELECT & FILTER GAMES
  ============================================================ -->
  <section class="collapsible-panel" id="section-3">
    <button class="collapsible-header">
      <span class="collapsible-icon">+</span>
      <span class="collapsible-title">3. Select & Filter Games</span>
    </button>
    <p class="section-subtitle" id="status-section-3">Filter games involving this team.</p>
    <div class="collapsible-body">
      <input id="filterInput" class="macos-input" placeholder="Filter by opponent, date, etc">
      <div class="filter-buttons">
        <button id="applyFilterBtn" class="btn">Apply Filter</button>
        <button id="clearFilterBtn" class="secondary">Clear Filter</button>
      </div>
    </div>
  </section>

  <!-- ============================================================
       4. BULK EDIT SELECTED LINEUPS
  ============================================================ -->
  <section class="collapsible-panel" id="section-4">
    <button class="collapsible-header">
      <span class="collapsible-icon">+</span>
      <span class="collapsible-title">4. Bulk Edit Selected Lineups</span>
    </button>
    <p class="section-subtitle" id="status-section-4">Edit selected games/lineups.</p>
    <div class="collapsible-body">
      <div class="macos-bulk-panel">
        <div class="macos-row">
          <label>Date</label>
          <input id="bulkDate" type="date" class="macos-input">
        </div>
        <div class="macos-row">
          <label>Location/Field</label>
          <input id="bulkLocation" type="text" class="macos-input">
        </div>
        <div class="macos-row two-columns">
          <div class="column"><label>Opponent</label><input id="bulkOpponent" class="macos-input"></div>
          <div class="column"><label>Notes</label><input id="bulkNotes" class="macos-input"></div>
        </div>
        <div class="macos-button-row">
          <button id="applyBulkBtn" class="btn">Apply to Selected</button>
          <button id="clearBulkBtn" class="secondary">Clear</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================================
       5. LINEUP CARD PREVIEW
  ============================================================ -->
  <section class="collapsible-panel" id="section-5">
    <button class="collapsible-header">
      <span class="collapsible-icon">+</span>
      <span class="collapsible-title">5. Lineup Card Preview</span>
    </button>
    <p class="section-subtitle" id="status-section-5">No cards to preview yet.</p>
    <div class="collapsible-body">
      <div id="previewContainer"></div>
    </div>
  </section>

  <!-- ============================================================
       6. TEMPLATE SELECTOR
  ============================================================ -->
<!-- ============================================================
     6. TEMPLATE SELECTOR
============================================================ -->
<section class="collapsible-panel" id="section-6">
  <button class="collapsible-header">
    <span class="collapsible-icon">+</span>
    <span class="collapsible-title">6. Choose Template</span>
  </button>
  <p class="section-subtitle" id="status-section-6">Select lineup or roster template.</p>

  <div class="collapsible-body">
    <!-- Template carousel -->
    <div class="template-carousel-wrapper">
      <button id="prevTemplate" class="carousel-arrow left">&lsaquo;</button>
      <div class="template-carousel">
        <div class="template-slide active">
          <img id="templateImage" alt="Template preview" />
        </div>
      </div>
      <button id="nextTemplate" class="carousel-arrow right">&rsaquo;</button>
    </div>

    <!-- Template name and status -->
    <p id="templateName" class="template-name"></p>
    <p id="templateStatus" class="template-status"></p>

    <!-- Inspect button -->
    <button id="inspectTemplateBtn" class="btn secondary">Inspect Template Fields</button>

    <!-- Field validation output -->

<!-- Template Field Validation Output -->
<div id="templateValidationOutputContainer" class="template-validation-container">
  <div class="template-validation-header">
    <strong>Template Fields</strong>
    <button id="copyTemplateFieldsBtn" class="btn small">Copy Fields</button>
  </div>
<div id="templateValidationOutput" class="template-validation-output"
     style="white-space: pre-wrap; font-family: monospace; color: #000;">
</div>
</div>

<!-- Template Field Inspector Modal -->
<div id="templateFieldInspector" class="modal-backdrop hidden">
  <div class="modal-content">
    <h2>PDF Template Fields</h2>
    <div id="templateFieldList"></div>
    <div class="modal-buttons">
      <button class="btn" id="closeFieldInspectorBtn">Close</button>
    </div>
  </div>
</div>
  </div>
</section>


<!-- Inline style for validation output -->
<style>
  #templateValidationOutput {
    color: #000; /* force black text */
    background: #fff; /* white background */
    border: 1px solid #ccc;
    padding: 0.6em;
    margin-top: 0.5em;
    max-height: 350px;
    overflow-y: auto;
    font-size: 0.9em;
    font-family: monospace;
  }
  #templateValidationOutput ul {
    list-style: disc;
    margin-left: 1.2em;
    padding-left: 0;
  }
  #templateValidationOutput li {
    margin-bottom: 0.5em;
  }
</style>

  <!-- ============================================================
       7. GENERATE LINEUP CARDS & ROSTERS
  ============================================================ -->
  <section class="collapsible-panel" id="section-7">
    <button class="collapsible-header">
      <span class="collapsible-icon">+</span>
      <span class="collapsible-title">7. Generate Lineup Cards & Rosters</span>
    </button>
    <p class="section-subtitle">Export selected cards</p>
    <div class="collapsible-body">
      <button id="generateBtn" class="btn fullwidth">Generate PDF</button>
      <p id="generateStatus"></p>
    </div>
  </section>

</div>

<footer>
  <p>© 2026 Law Five Referee</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script type="module" src="js/module-loader.js"></script>

<script type="module" src="js/lineup-card-factory.js?v=20260113a"></script>

<!-- Edit Lineup / Team Card Modal -->
<div id="lineupEditModal" class="modal-backdrop hidden">
  <div class="modal-content">
    <h2>Edit Card</h2>
    <div id="lineupEditModalBody"></div>
    <div class="modal-buttons">
      <button id="saveLineupEditBtn" class="btn">Save</button>
      <button id="cancelLineupEditBtn" class="secondary">Cancel</button>
    </div>
  </div>
</div>
</body>
</html>
